<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gusen Character Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
        }

        #gameContainer {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        canvas {
            border: 3px solid #333;
            display: block;
            background: #87ceeb;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            image-rendering: -moz-crisp-edges;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        #controls {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
            text-align: center;
        }

        h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .info {
            color: #333;
            margin: 5px 0;
        }

        .key {
            display: inline-block;
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border-radius: 3px;
            margin: 0 3px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üéÆ Gusen Character Game üéÆ</h1>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="controls">
            <div class="info">
                <strong>Controls:</strong>
                <span class="key">‚Üë</span>
                <span class="key">‚Üì</span>
                <span class="key">‚Üê</span>
                <span class="key">‚Üí</span>
                to move player
            </div>
            <div class="info">
                <strong>Goal:</strong> Explore the world and interact with other characters!
            </div>
            <div class="info" id="score">Score: 0</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Disable image smoothing for crisp pixel art
        ctx.imageSmoothingEnabled = false;
        ctx.mozImageSmoothingEnabled = false;
        ctx.webkitImageSmoothingEnabled = false;
        ctx.msImageSmoothingEnabled = false;

        // Game state
        const game = {
            score: 0,
            frame: 0,
            keys: {},
            characters: [],
            player: null,
            assetsLoaded: 0,
            totalAssets: 0,
            gameStarted: false
        };

        // Sprite class to handle 2-frame animations
        class Character {
            constructor(imagePath, x, y, isPlayer = false) {
                this.x = x;
                this.y = y;
                this.scale = 4; // Scale up the tiny sprites
                this.width = 64; // Will be adjusted when image loads
                this.height = 64; // Will be adjusted when image loads
                this.speed = isPlayer ? 3 : 1.5;
                this.isPlayer = isPlayer;
                this.image = new Image();
                this.image.src = imagePath;
                this.loaded = false;
                this.currentFrame = 0;
                this.frameTimer = 0;
                this.frameDelay = 15; // Frames between sprite animation
                this.name = imagePath.replace('.png', '');

                // Movement for NPCs
                if (!isPlayer) {
                    this.dirX = (Math.random() - 0.5) * 2;
                    this.dirY = (Math.random() - 0.5) * 2;
                    this.changeDirectionTimer = 0;
                }

                game.totalAssets++;

                this.image.onload = () => {
                    this.loaded = true;
                    game.assetsLoaded++;
                    // Image is split horizontally: top half is frame 0, bottom half is frame 1
                    this.frameHeight = this.image.height / 2;
                    this.frameWidth = this.image.width;
                    // Adjust character size based on actual sprite size
                    this.width = this.frameWidth * this.scale;
                    this.height = this.frameHeight * this.scale;
                    console.log(`Loaded ${imagePath}: ${this.frameWidth}x${this.frameHeight} (scaled to ${this.width}x${this.height})`);

                    if (game.assetsLoaded === game.totalAssets) {
                        console.log('All assets loaded!');
                        game.gameStarted = true;
                    }
                };

                this.image.onerror = () => {
                    console.error(`Failed to load image: ${imagePath}`);
                    game.assetsLoaded++;
                    if (game.assetsLoaded === game.totalAssets) {
                        game.gameStarted = true;
                    }
                };
            }

            update() {
                // Update animation
                this.frameTimer++;
                if (this.frameTimer >= this.frameDelay) {
                    this.currentFrame = (this.currentFrame + 1) % 2;
                    this.frameTimer = 0;
                }

                if (this.isPlayer) {
                    // Player movement
                    if (game.keys['ArrowUp'] || game.keys['w']) this.y -= this.speed;
                    if (game.keys['ArrowDown'] || game.keys['s']) this.y += this.speed;
                    if (game.keys['ArrowLeft'] || game.keys['a']) this.x -= this.speed;
                    if (game.keys['ArrowRight'] || game.keys['d']) this.x += this.speed;

                    // Keep player in bounds
                    this.x = Math.max(0, Math.min(canvas.width - this.width, this.x));
                    this.y = Math.max(0, Math.min(canvas.height - this.height, this.y));
                } else {
                    // NPC movement
                    this.changeDirectionTimer++;
                    if (this.changeDirectionTimer > 120) {
                        this.dirX = (Math.random() - 0.5) * 2;
                        this.dirY = (Math.random() - 0.5) * 2;
                        this.changeDirectionTimer = 0;
                    }

                    this.x += this.dirX * this.speed;
                    this.y += this.dirY * this.speed;

                    // Bounce off walls
                    if (this.x < 0 || this.x > canvas.width - this.width) {
                        this.dirX *= -1;
                        this.x = Math.max(0, Math.min(canvas.width - this.width, this.x));
                    }
                    if (this.y < 0 || this.y > canvas.height - this.height) {
                        this.dirY *= -1;
                        this.y = Math.max(0, Math.min(canvas.height - this.height, this.y));
                    }
                }
            }

            draw() {
                if (!this.loaded) return;

                // Save context state
                ctx.save();

                // Draw the current frame (split horizontally)
                ctx.drawImage(
                    this.image,
                    0, // source x
                    this.currentFrame * this.frameHeight, // source y (0 for frame 0, frameHeight for frame 1)
                    this.frameWidth, // source width
                    this.frameHeight, // source height
                    Math.floor(this.x), // destination x
                    Math.floor(this.y), // destination y
                    this.width, // destination width (scaled)
                    this.height // destination height (scaled)
                );

                // Draw name tag for player
                if (this.isPlayer) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(this.x, this.y - 20, this.width, 15);
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('PLAYER', this.x + this.width / 2, this.y - 8);
                }

                ctx.restore();
            }

            checkCollision(other) {
                return this.x < other.x + other.width &&
                       this.x + this.width > other.x &&
                       this.y < other.y + other.height &&
                       this.y + this.height > other.y;
            }
        }

        // Initialize game
        function init() {
            // Create player
            game.player = new Character('player.png', 400, 300, true);
            game.characters.push(game.player);

            // Create NPCs with different sprites
            const npcSprites = [
                'npc1.png',
                'npc2.png',
                'sprite.png',
                'sprite2.png',
                'sprite3.png',
                'sprite4.png',
                'sprite5.png',
                'dinggusen.png',
                'gressgusen.png',
                'lanternegusen.png',
                'lunagusen.png',
                'spaghettigusen.png',
                'wirelessgusen.png',
                'generatorgusen.png'
            ];

            // Create NPCs at random positions
            for (let i = 0; i < 8; i++) {
                const sprite = npcSprites[i % npcSprites.length];
                const x = Math.random() * (canvas.width - 100);
                const y = Math.random() * (canvas.height - 100);
                game.characters.push(new Character(sprite, x, y, false));
            }

            console.log(`Game initialized with ${game.characters.length} characters`);
            console.log(`Loading ${game.totalAssets} assets...`);
        }

        // Game loop
        function gameLoop() {
            // Clear canvas
            ctx.fillStyle = '#87ceeb';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Show loading screen if assets aren't loaded
            if (!game.gameStarted) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = 'bold 32px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Loading...', canvas.width / 2, canvas.height / 2 - 20);
                ctx.font = '20px Arial';
                ctx.fillText(`${game.assetsLoaded} / ${game.totalAssets} sprites loaded`, canvas.width / 2, canvas.height / 2 + 20);
                requestAnimationFrame(gameLoop);
                return;
            }

            // Draw ground/grass pattern
            ctx.fillStyle = '#90ee90';
            for (let i = 0; i < canvas.width; i += 40) {
                for (let j = 0; j < canvas.height; j += 40) {
                    if ((i + j) % 80 === 0) {
                        ctx.fillRect(i, j, 40, 40);
                    }
                }
            }

            // Update and draw all characters
            game.characters.forEach(char => {
                char.update();
            });

            // Check collisions between player and NPCs
            if (game.player) {
                game.characters.forEach(char => {
                    if (!char.isPlayer && char.loaded && game.player.checkCollision(char)) {
                        // Simple collision response - bounce back
                        if (game.frame % 60 === 0) {
                            game.score += 10;
                            document.getElementById('score').textContent = 'Score: ' + game.score;
                        }
                    }
                });
            }

            // Draw all characters
            game.characters.forEach(char => {
                char.draw();
            });

            // Draw UI
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(10, 10, 250, 50);
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Characters: ' + game.characters.length, 20, 30);
            ctx.fillText('Loaded: ' + game.characters.filter(c => c.loaded).length, 20, 50);

            game.frame++;
            requestAnimationFrame(gameLoop);
        }

        // Event listeners
        window.addEventListener('keydown', (e) => {
            game.keys[e.key] = true;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                e.preventDefault();
            }
        });

        window.addEventListener('keyup', (e) => {
            game.keys[e.key] = false;
        });

        // Start game
        init();
        gameLoop();
    </script>
</body>
</html>
